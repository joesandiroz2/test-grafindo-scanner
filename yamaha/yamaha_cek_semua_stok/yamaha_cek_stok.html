<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aplikasi Yamaha</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Tambahkan di head -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<style>
  /* Hapus overflow agar scroll dari body, bukan tabel */
  .table-responsive {
    overflow: visible !important;
  }

  /* Biar thead menempel saat halaman discroll */
  thead th {
    position: sticky;
    top: 0;
    z-index: 10;
    background-color: #212529;
    color: white;
  }

  /* Tambahan opsional agar efeknya lebih rapi */
  thead {
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
  }
</style>

</head>
<body>

  <div id="navbar-container"></div>

  <div class="container my-4">
    <h5><i class="bi bi-clipboard-check"></i> Cek Semua Stok</h5>

    <!-- Progress bar -->
    <div class="progress my-3">
      <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" 
           role="progressbar" style="width: 0%">0%</div>
    </div>
    <div id="status-text"></div>


    <button id="downloadExcel" class="btn btn-info">
  <i class="bi bi-file-earmark-excel"></i> Download Excel
</button>

    <!-- Tabel hasil -->
    <div class="table-responsive">
      <table class="table table-striped table-bordered mt-3">
    <thead class="table-dark sticky-top">
          <tr>
            <th>No</th>
            <th>Part Number</th>
            <th>Nama Barang</th>
            <th>Balance Terakhir</th>
              <th>Tgl</th>
              <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="stock-table-body">
          <!-- data diisi via JS -->
        </tbody>
      </table>
    </div>
  </div>

<!-- Modal Perbaiki -->
<div class="modal fade" id="perbaikiModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-warning">
        <h5 class="modal-title"><i class="bi bi-tools"></i> Perbaiki Balance</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form id="perbaikiForm">
          <div class="mb-3">
            <label class="form-label">Part Number</label>
            <input type="text" id="modalPartNumber" class="form-control" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">Nama Barang</label>
            <input type="text" id="modalNamaBarang" class="form-control" readonly>
          </div>
          <div class="mb-3">
            <label class="form-label">No DO</label>
            <input type="text" value="perbaikan Pa SOPIAN" id="modalNoDo" class="form-control" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Qty Perbaikan</label>
            <input type="number" id="modalQty" class="form-control" required>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary" onclick="submitPerbaikan()">Simpan</button>
      </div>
    </div>
  </div>
</div>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>


<script src="../../js/sdk/pocketbase.umd.js"></script>
<script src="../../js/pocket_config.js"></script>
  <!-- Load Navbar -->
  <script>
    $(document).ready(function () {
      $("#navbar-container").load("../../component/nav.html", function () {
        setTimeout(loginUser, 500);
      });
    });

document.getElementById("downloadExcel").addEventListener("click", function () {
  const table = document.querySelector("table");
  const tableClone = table.cloneNode(true);

  // hapus kolom terakhir (index 4) di thead
  tableClone.querySelectorAll("thead tr").forEach(tr => {
    if (tr.cells.length > 4) {
      tr.deleteCell(4);
    }
  });

  // hapus kolom terakhir (index 4) di tbody
  tableClone.querySelectorAll("tbody tr").forEach(tr => {
    if (tr.cells.length > 4) {
      tr.deleteCell(4);
    }
  });

  // export tanpa kolom terakhir
  const wb = XLSX.utils.table_to_book(tableClone, { sheet: "Stok Yamaha" });
  XLSX.writeFile(wb, "stok_yamaha.xlsx");

  Swal.fire({
    icon: 'success',
    title: 'Berhasil!',
    text: 'Data berhasil diunduh tanpa kolom Hapus/Tgl.',
    showConfirmButton: false,
    timer: 2000
  });
});



  </script>


  <!-- Script cek stok -->
  <script src="./js/yamaha_cek_stok.js"></script>
</body>
</html>
