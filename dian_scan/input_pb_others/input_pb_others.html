<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aplikasi Yamaha - Input Penyerahan Barang</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

</head>
<body>

  <div id="navbar-container"></div>

  <div class="container mt-1"> 
      <a class="btn btn-success" href="/dian_scan/input_pb_others/input_set_others/input_set_others.html"> 
        Input Penyerahan SET Barang Others
      </a>

  </div>

   <div class="row m-3"> 
      <div  id="formContainer" class="col-md-6 col-lg-6 col-sm-12" style="border:1px solid black"> 
           <!-- Tambahan select di atas form -->
      <div class="mb-3 mt-2">
        <label for="jenisTransaksi" class="form-label fw-bold">Pilih Jenis Transaksi</label>
        <select id="jenisTransaksi" class="form-select">
          <option value="masuk" selected>Penyerahan Barang (Masuk)</option>
          <option value="keluar">Pengeluaran Barang</option>
        </select>
      </div>


           <h3  id="judulForm">Input Penyerahan Barang Others</h3>
            <form id="penyerahanForm" class="mt-3">
            <span id="loadingInfo" style="color:purple;font-weight:bold">Sedang mencari part...</span>
           
            <div style="border:2px solid black;padding:10px">
              <h6>Cari part Disini</h6>
            <select id="pencarian_part"></select>
          </div>


              <div class="mb-3">
                <label for="partNumber" class="form-label">Part Number</label>
                <input type="text" style="font-weight:bold" class="form-control" id="partNumber" required>
              </div>

              <div class="mb-3">
                <label for="partNumber" class="form-label">Nama Barang</label>
                <input type="text" class="form-control" id="nama_barang" required>
              </div>



              <div class="mb-3">
                <label for="no_pb" class="form-label">No PB</label>
                <input type="text" class="form-control" id="no_pb" required>
              </div>

              <div class="mb-3">
                <label for="lot" class="form-label">Lot</label>
                <input type="text" class="form-control" id="lot" required>
              </div>

              <div class="mb-3">
                <label for="qtyMasuk" class="form-label">Qty</label>
                <input type="number"  class="form-control" id="qtyMasuk" required>
              </div>

              <button  id="btnMasuk" type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Masukkan
              </button>

               <!-- Tombol KELUAR -->
        <button id="btnKeluar" type="button" class="btn btn-danger d-none">
          <i class="bi bi-box-arrow-up"></i> Keluarkan
        </button>

            </form>

            <div id="resultMessage" class="mt-3"></div>

      </div>
      <div class="col-md-6 col-lg-6 col-sm-12">
      <h5>Tabel Data in/out Barang Others terakhir</h5> 


        <!-- ⏳ Spinner preloader -->
  <div id="preloader" class="text-center my-3">
    <div class="spinner-border fw-bold" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2 fw-bold ">Sedang loading data stok terbaru....</p>
  </div>


      <table id="tbl_data_masuk" class="table table-bordered table-striped table-sm"></table>

      </div>
   </div>


<!-- MODAL EDIT -->
<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-warning">
        <h5 class="modal-title" id="editModalLabel">Edit Data Barang</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form id="editForm">
          <input type="hidden" id="editId">

          <div class="mb-3">
            <label for="editPb" class="form-label fw-bold">No PB</label>
            <input type="text" id="editPb" class="form-control" required>
          </div>

          <div class="mb-3">
            <label for="editLot" class="form-label fw-bold">Lot</label>
            <input type="text" id="editLot" class="form-control" required>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        <button type="button" class="btn btn-primary" id="saveEditBtn">
          <i class="bi bi-save"></i> Simpan Perubahan
        </button>
      </div>
    </div>
  </div>
</div>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- Tambahkan CSS & JS Select2 -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script src="../../js/sdk/pocketbase.umd.js"></script>
  <script src="../../js/pocket_config.js"></script>
  <script src="./js/input_pb_others.js"></script>
  <script src="./js/tabel_data_masuk.js"></script>

  <!-- Load Navbar -->
  <script>
    $(document).ready(function () {
      $("#navbar-container").load("../../component/nav.html", function () {
        setTimeout(loginUser, 500);
      });
    })
$(document).ready(async function () {

  // fungsi ambil semua data dari API sampai page terakhir
  async function fetchAllParts() {
    let allItems = [];
    let page = 1;
    let totalPages = 1;
     let totalItems = 0;

     const loadingInfo = $("#loadingInfo");

    do {
      const res = await fetch(`${pocketbaseUrl}/api/collections/other_unik_partnumber/records?page=${page}&perPage=50`);
      const data = await res.json();

      allItems = allItems.concat(data.items);
       // update progress
      loadingInfo.text(`Sedang memuat ${allItems.length} dari ${totalItems}...`);

      totalPages = data.totalPages;
      page++;
    } while (page <= totalPages);

      // kalau sudah selesai → sembunyikan
    loadingInfo.hide();


    return allItems;
  }

  // ambil semua part
  const parts = await fetchAllParts();

  // isi ke select2
  $("#pencarian_part").select2({
    placeholder: "Cari Part...",
    allowClear: true,
    width: "100%",
    data: parts.map(item => ({
      id: item.id,
      text: `${item.part_number} - ${item.nama_barang}`,
      part_number: item.part_number,
      nama_barang: item.nama_barang
    }))
  });

  // kalau user pilih dari select → isi input
  $("#pencarian_part").on("select2:select", function(e) {
    const data = e.params.data;
    $("#partNumber").val(data.part_number);
    $("#nama_barang").val(data.nama_barang);
  });

  // kalau clear select → kosongkan input
  $("#pencarian_part").on("select2:clear", function() {
    $("#partNumber").val("");
    $("#nama_barang").val("");
  });

});

  </script>

<script>
  $(document).ready(function() {
    // --- FUNGSI UBAH WARNA DAN TOMBOL ---
    $("#jenisTransaksi").on("change", function() {
      const val = $(this).val();
      const formContainer = $("#formContainer"); // ✅ ini sudah benar sekarang
      const judulForm = $("#judulForm");
      const btnMasuk = $("#btnMasuk");
      const btnKeluar = $("#btnKeluar");

      if (val === "keluar") {
        // Mode Pengeluaran
        formContainer.css({
          backgroundColor: "red",
          color: "white",
          transition: "0.3s"
        });
        judulForm.text("Input Pengeluaran Barang Others");
        btnMasuk.addClass("d-none");
        btnKeluar.removeClass("d-none");
      } else {
        // Mode Pemasukan
        formContainer.css({
          backgroundColor: "white",
          color: "black",
          transition: "0.3s"
        });
        judulForm.text("Input Penyerahan Barang Others");
        btnMasuk.removeClass("d-none");
        btnKeluar.addClass("d-none");
      }
    });
  });
</script>

</body>
</html>
