<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Aplikasi Yamaha - Input Penyerahan Barang</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

</head>
<body>

  <div id="navbar-container"></div>

  <div class="container mt-1"> 
      <a class="btn btn-success" href="/dian_scan/input_pb_others/input_set_others/input_set_others.html"> 
        Input Penyerahan SET Barang Others
      </a>

  </div>

   <div class="row m-3"> 
      <div class="col-md-6 col-lg-6 col-sm-12" style="border:1px solid black"> 
           <h3>Input Penyerahan Barang Others</h3>
            <form id="penyerahanForm" class="mt-3">
            <span id="loadingInfo" style="color:purple;font-weight:bold">Sedang mencari part...</span>
            <select id="pencarian_part"></select>

              <div class="mb-3">
                <label for="partNumber" class="form-label">Part Number</label>
                <input type="text" style="font-weight:bold" class="form-control" id="partNumber" required>
              </div>

              <div class="mb-3">
                <label for="partNumber" class="form-label">Nama Barang</label>
                <input type="text" class="form-control" id="nama_barang" required>
              </div>


              <div class="mb-3">
                <label for="lot" class="form-label">Lot</label>
                <input type="text" class="form-control" id="lot" required>
              </div>

              <div class="mb-3">
                <label for="qtyMasuk" class="form-label">Qty Masuk</label>
                <input type="number"  class="form-control" id="qtyMasuk" required>
              </div>

              <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Masukkan
              </button>
            </form>

            <div id="resultMessage" class="mt-3"></div>

      </div>
      <div class="col-md-6 col-lg-6 col-sm-12">
      <h5>Tabel Data penyerahan Masuk Barang Others</h5> 
      <table id="tbl_data_masuk" class="table table-bordered table-striped table-sm"></table>

      </div>
   </div>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- Tambahkan CSS & JS Select2 -->
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

  <script src="../../js/sdk/pocketbase.umd.js"></script>
  <script src="../../js/pocket_config.js"></script>
  <script src="./js/input_pb_others.js"></script>
  <script src="./js/tabel_data_masuk.js"></script>

  <!-- Load Navbar -->
  <script>
    $(document).ready(function () {
      $("#navbar-container").load("../../component/nav.html", function () {
        setTimeout(loginUser, 500);
      });
    })
$(document).ready(async function () {

  // fungsi ambil semua data dari API sampai page terakhir
  async function fetchAllParts() {
    let allItems = [];
    let page = 1;
    let totalPages = 1;
     let totalItems = 0;

     const loadingInfo = $("#loadingInfo");

    do {
      const res = await fetch(`${pocketbaseUrl}/api/collections/other_unik_partnumber/records?page=${page}&perPage=50`);
      const data = await res.json();

      allItems = allItems.concat(data.items);
       // update progress
      loadingInfo.text(`Sedang memuat ${allItems.length} dari ${totalItems}...`);

      totalPages = data.totalPages;
      page++;
    } while (page <= totalPages);

      // kalau sudah selesai → sembunyikan
    loadingInfo.hide();


    return allItems;
  }

  // ambil semua part
  const parts = await fetchAllParts();

  // isi ke select2
  $("#pencarian_part").select2({
    placeholder: "Cari Part...",
    allowClear: true,
    width: "100%",
    data: parts.map(item => ({
      id: item.id,
      text: `${item.part_number} - ${item.nama_barang}`,
      part_number: item.part_number,
      nama_barang: item.nama_barang
    }))
  });

  // kalau user pilih dari select → isi input
  $("#pencarian_part").on("select2:select", function(e) {
    const data = e.params.data;
    $("#partNumber").val(data.part_number);
    $("#nama_barang").val(data.nama_barang);
  });

  // kalau clear select → kosongkan input
  $("#pencarian_part").on("select2:clear", function() {
    $("#partNumber").val("");
    $("#nama_barang").val("");
  });

});

  </script>
</body>
</html>
